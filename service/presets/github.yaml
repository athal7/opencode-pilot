# GitHub source presets (using gh CLI)
#
# These presets use the `gh` CLI instead of requiring a GitHub MCP server.
# The gh CLI must be installed and authenticated (gh auth login).

# Provider-level config (applies to all GitHub presets)
_provider:
  mappings:
    # Map gh CLI fields to standard fields
    html_url: url
    repository_full_name: repository.nameWithOwner
    updated_at: updatedAt
    comments: commentsCount
  # Reprocess items when state changes (e.g., reopened issues)
  # Note: updated_at is NOT included because our own changes would trigger reprocessing
  reprocess_on:
    - state        # Detect reopened (closed -> open)

# Presets
my-issues:
  name: my-issues
  tool:
    command: ["gh", "search", "issues", "--assignee=@me", "--state=open", "--json", "number,title,url,repository,state,body,updatedAt"]
  item:
    id: "{url}"
  repo: "{repository.nameWithOwner}"
  worktree_name: "issue-{number}"
  session:
    name: "{title}"

review-requests:
  name: review-requests
  tool:
    command: ["gh", "search", "prs", "--review-requested=@me", "--state=open", "--json", "number,title,url,repository,state,body,updatedAt"]
  item:
    id: "{url}"
  repo: "{repository.nameWithOwner}"
  prompt: review
  worktree_name: "pr-{number}"
  session:
    name: "Review: {title}"
  # Detect stacked PRs and reuse sessions across the stack
  detect_stacks: true

my-prs-attention:
  name: my-prs-attention
  tool:
    # Get all open PRs authored by me - we filter by conditions after enrichment
    command: ["gh", "search", "prs", "--author=@me", "--state=open", "--json", "number,title,url,repository,state,body,updatedAt,commentsCount"]
  item:
    id: "{url}"
  repo: "{repository.nameWithOwner}"
  prompt: review-feedback
  worktree_name: "pr-{number}"
  session:
    # Dynamic name showing which conditions triggered (set by enrichment)
    name: "{_attention_label}: {title}"
  # Enrich with both mergeable status and comments to detect all attention conditions
  enrich_mergeable: true
  filter_bot_comments: true
  # Detect stacked PRs and reuse sessions across the stack
  detect_stacks: true
  readiness:
    # Require at least one attention condition (conflicts or human feedback)
    require_attention: true
  # Reprocess when state changes (reopened) or new feedback received
  # Note: updatedAt is NOT included - CI status changes would trigger reprocessing
  reprocess_on:
    - state
    - attention
