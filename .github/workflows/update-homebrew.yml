name: Update Homebrew Formula

on:
  release:
    types: [released]

jobs:
  homebrew:
    runs-on: ubuntu-latest
    steps:
      - name: Generate GitHub App token
        id: app-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ vars.HOMEBREW_APP_ID }}
          private-key: ${{ secrets.HOMEBREW_APP_PRIVATE_KEY }}
          owner: athal7
          repositories: homebrew-tap

      - name: Update Homebrew formula
        uses: mislav/bump-homebrew-formula-action@v3
        with:
          formula-name: opencode-ntfy
          homebrew-tap: athal7/homebrew-tap
          tag-name: ${{ github.event.release.tag_name }}
          download-url: https://github.com/athal7/opencode-ntfy.git
          push-to: athal7/homebrew-tap
          base-branch: main
          create-pullrequest: false
          create-branch: false
          commit-message: |
            chore: bump {{formulaName}} to {{version}}
        env:
          COMMITTER_TOKEN: ${{ steps.app-token.outputs.token }}
