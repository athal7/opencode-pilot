# Example repos.yaml configuration for opencode-pilot polling
#
# Copy to ~/.config/opencode-pilot/repos.yaml and customize
#
# Configuration uses prefix matching - "myorg/" matches all "myorg/*" repos.
# More specific paths override less specific ones (deep merge).

# Global settings (apply to all repos)
global:
  wip_limits:
    max_concurrent: 10  # Maximum total concurrent sessions across all repos

repos:
  # Organization-wide defaults (prefix match)
  myorg/:
    # Path to local repo clone - {repo} expands to full repo name
    repo_path: ~/code/{repo}

    # WIP limits control concurrent sessions
    wip_limits:
      max_concurrent: 3

    # Default action for all repos in this org
    action:
      type: local  # "local" for opencode, "container" for ocdc

    # Session naming template
    session:
      name_template: "{type}-{number}"

    # Readiness checks - when is an issue ready to work on?
    readiness:
      labels:
        # Issues with these labels are never ready
        exclude:
          - blocked
          - wontfix
          - "needs-design"

        # At least one of these labels must be present
        any_of:
          - "ocdc:ready"
          - "ready-for-dev"

      # How to calculate priority (higher = picked first)
      priority:
        # Label weights
        labels:
          - { label: critical, weight: 100 }
          - { label: urgent, weight: 80 }
          - { label: high-priority, weight: 50 }
          - { label: bug, weight: 30 }

        # Age weight: points per day since creation
        age_weight: 1

  # Specific repo overrides (exact match)
  myorg/backend:
    # Override repo path for this specific repo
    repo_path: ~/code/backend-monorepo

    # Use devcontainers for this repo
    action:
      type: container

    # Sources define what to poll
    sources:
      # Poll GitHub issues assigned to me
      - type: github_issue
        fetch:
          assignee: "@me"
          labels:
            - "ocdc:ready"
          state: open

      # Poll GitHub PRs that need review
      - type: github_pr
        fetch:
          state: open
          requested_reviewer: "@me"

  # Another repo with Linear integration
  myorg/frontend:
    sources:
      # Poll Linear issues
      - type: linear_issue
        fetch:
          assignee: "@me"
          status:
            - "Todo"
            - "In Progress"

    # Custom readiness for this repo
    readiness:
      labels:
        exclude:
          - blocked
        # No required labels for this repo
        any_of: []

  # Personal projects with simpler config
  personal/:
    repo_path: ~/projects/{repo}
    wip_limits:
      max_concurrent: 1
    sources:
      - type: github_issue
        fetch:
          assignee: "@me"
    readiness:
      labels:
        exclude: []
        any_of: []
